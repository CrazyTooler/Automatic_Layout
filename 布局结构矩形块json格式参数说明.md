## 布局数据的标准JSON格式

-----

**Note:**文档主要介绍分别在经过[布局结构推断](#布局结构推断数据)和[矩形参数规划](#矩形参数规划数据)之后所得到的JSON格式数据，该数据将作为后续排版流程的参考或必要参数；

+ [1.布局推断结果数据格式](#1.布局结构推断数据)
  + [1.1 结构表示方法说明](#1.1 布局结构表示)
  + [1.2 结构JSON数据字段说明](#1.2 结构JSON数据字段说明)
+ [2.布局矩形规划结果数据格式](#2.布局矩形规划结果数据格式)
  + [2.1 布局矩形JSON数据字段说明](#2.1 布局矩形JSON数据字段说明)

### 1.布局推断数据

---

#### 1.1 布局结构表示

> 使用二叉树来表示布局结构矩形的划分，节点表示划分的矩形；非叶子节点为可划分的矩形并包含划分方式，叶子节点为不可再分的矩形，用于放置文章。

+ 非叶子节点R表示将矩形划分成上下两个矩形
+ 非叶子节点C表示将矩形划分成左右两个矩形

![绘图1](C:\Users\Administrator\Desktop\绘图1.png)

按照二叉树先序遍历非叶子节点顺序划分矩形，矩形划分遵从从左到右从上到下的顺序，保证二叉树唯一。默认叶子节点矩形按照中序遍历顺序编号；页面结构用非叶子节点的先序顺序表示。

#### 1.2 结构JSON数据字段说明

> 基于特征数据、用户提交素材和用户设置来推断结构、头条宽度和图形元素尺寸。

主要包括以下字段

+ **user_id**--用户id，用于唯一标识用户信息。
+ **material_id**：素材id，用于唯一标识用户的此次提交的素材信息。通过用户标识和素材标识在数据库找对应新闻素材和设置信息。
+ **articles_cnt**：文章数量，表示素材中新闻篇数。
+ **paper_struct**：:表示结构推断结果
  + **content**: 表示版面结构（不包括报头），非叶子节点使用'C1'，'R1'表示，使用'(...)'表示非叶子节点的子树；其中C1(...)(...)表示将版面分成左右两个矩形，R1(...)(...)表示将版面分成上下两个矩形；()表示叶子节点，即文章所在矩形。
  + **infer_id**: 表示一次特定的推断结果
  + **count**： 表示推断的结构数量
  + **id**：表示某一版面结构
+ **article_struct**: 表示文章推断结果
  + **headw:**头条宽度，表示相对于报纸版面而言头条新闻所在矩形的宽度。
  + **infer_id**: 表示一次特定的推断结果
  + **pic_size:**图形元素大小，pic_size[n]表示相对于报纸面积第n篇新闻包含的图形元素的面积。

```json
{
    "user_id": 1234, 
    "material_id": 5678,
    "articles_cnt": 6,
    "paper_struct": {
        "infer_id": "timestamp",
        "count": 8,
        "id": 4,
        "content": "C1(R1()(R1()(R1()())))(R1()())"
    },
    "article_struct":{
        "infer_id": "timestamp",
        "headw": 0.70,
        "pic_size": {
            "1": 0.0,
            "2": 0.0,
            "3": 0.12,
            "4": 0.0,
            "5": 0.0,
            "6": 0.0,
        }
    }
}
```

### 2.布局矩形规划结果数据格式

---

#### 2.1 布局矩形JSON数据字段说明

> 基于布局推断数据、新闻放置顺序和用户设置来建立整数规划模型，求解得到划分矩形的具体位置及长宽参数。

新增字段

+ **articles_seq**：文章位置序列，articles_seq[i]=k表示第k篇新闻位于第i个矩形位置。

+ **progress**
  + **progress_id**：表示一次规划过程。
  + **progress_obj**：布局结构规划值，规划值越小表示版面结构得分越高。
  + **rec_disc**：表示版面矩形的大小位置信息描述，其中n表示第n个矩形的位置信息[x,y,w,h],其中x,y表示矩形左下角坐标；w,h表示矩形宽度和高度；坐标原点为报纸左下角。“0”表示报头。

```json
{
    "user_id": 1234, 
    "material_id": 5678,
    "articles_cnt": 6,
    "paper_struct": {
        "infer_id": "user_id+material_id+timestamp",
        "count": 8,
        "id": 4,
        "content": "C1(R1()(R1()(R1()())))(R1()())"
    },
    "article_struct":{
        "infer_id": "user_id+material_id+timestamp",
        "headw": 0.70,
        "pic_size": {
            "1": 0.0,
            "2": 0.0,
            "3": 0.12,
            "4": 0.0,
            "5": 0.0,
            "6": 0.0,
        }
    },
    "articles_seq": [
        1,
        5,
        3,
        6,
        2,
        4
    ],
    "progress":{
        "id":infer_id + article_seq,
        "progress_obj": 20.0,
        "rec_disc":{
            "0": [
                0.0,
                83.0,
                100.0,
                17.0
            ],
            "1": [
                0.0,
                59.214,
                66.365625,
                23.786
            ],
            "2": [
                0.0,
                43.668,
                66.365625,
                15.546
            ],
            "3": [
                0.0,
                23.36,
                66.365625,
                20.308
            ],
            "4": [
                0.0,
                0.0,
                66.365625,
                23.36
            ],
            "5": [
                66.365625,
                37.25,
                33.634375,
                45.75
            ],
            "6": [
                66.365625,
                0.0,
                33.634375,
                37.25
            ]   
        }
    },
}
```

